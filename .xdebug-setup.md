# Xdebug Setup (Development Mode)

Xdebug is automatically enabled in development mode and configured for step debugging.

## Configuration

- **Mode**: `debug,develop`
- **Port**: `9003`
- **Client Host**: `host.docker.internal`
- **IDE Key**: `PHPSTORM`
- **Start with request**: `trigger` (requires activation)

## Activation Methods

### Browser (recommended)
Install a browser extension:
- **Chrome/Edge**: [Xdebug Helper](https://chrome.google.com/webstore/detail/xdebug-helper/eadndfjplgieldjbigjakmdgkmoaaaoc)
- **Firefox**: [Xdebug Helper](https://addons.mozilla.org/en-US/firefox/addon/xdebug-helper-for-firefox/)

Toggle the extension to start debugging.

### Query String
Add `?XDEBUG_SESSION_START=PHPSTORM` to any URL:
```
http://localhost/admin?XDEBUG_SESSION_START=PHPSTORM
```

### Cookie
Set cookie `XDEBUG_SESSION=PHPSTORM`

### CLI
Export environment variable:
```bash
docker-compose exec -it php bash
export XDEBUG_SESSION=1
php ./bin/console <command>
```

## IDE Configuration

### PHPStorm
1. **Settings → PHP → Debug**
   - Port: `9003`
   - Check "Can accept external connections"
2. **Settings → PHP → Servers**
   - Name: `docker` (or any name matching your IDE key)
   - Host: `localhost`
   - Port: `80`
   - Path mappings: Map `/var/www/html` to your local project root
3. Click "Start Listening for PHP Debug Connections" (phone icon)
4. Set breakpoints and trigger a request

### VS Code
Install the [PHP Debug extension](https://marketplace.visualstudio.com/items?itemName=xdebug.php-debug).

Add to `.vscode/launch.json`:
```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Listen for Xdebug",
      "type": "php",
      "request": "launch",
      "port": 9003,
      "pathMappings": {
        "/var/www/html": "${workspaceFolder}"
      }
    }
  ]
}
```

## Troubleshooting

### Check Xdebug is loaded
```bash
docker-compose exec -it php php -v
# Should show "with Xdebug v3.x.x"
```

### Check Xdebug configuration
```bash
docker-compose exec -it php php -i | grep xdebug
```

### Not hitting breakpoints?
1. Ensure IDE is listening on port 9003
2. Check path mappings match `/var/www/html` → your project root
3. Verify Xdebug session is active (check browser extension or query string)
4. Check Docker network allows host.docker.internal (may need `extra_hosts` on some systems)

### macOS/Windows: `host.docker.internal` not working?
Add to `docker-compose.yml` under the `php` service:
```yaml
extra_hosts:
  - "host.docker.internal:host-gateway"
```
