<div class="modal-content" style="min-width: min(750px, 95vw);">
  <div class="modal-header">
    <h5 class="modal-title">
      <i class="bi bi-journal-text me-2"></i>
      Audit Details #{{ audit.id }}
    </h5>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
  </div>

  <div class="modal-body">
    {% if error %}
      <div class="alert alert-danger">{{ error }}</div>
    {% else %}
      <div class="row mb-3">
        <div class="col-md-6">
          <table class="table table-sm">
            <tr>
              <th class="text-muted">Event</th>
              <td>
                {% set badge_class = audit.event == 'created' ? 'bg-success' : (audit.event == 'updated' ? 'bg-warning text-dark' : 'bg-danger') %}
                <span class="badge {{ badge_class }}">{{ audit.event|capitalize }}</span>
              </td>
            </tr>
            <tr>
              <th class="text-muted">Model</th>
              <td>{{ audit.auditable_type }} #{{ audit.auditable_id }}</td>
            </tr>
            <tr>
              <th class="text-muted">User</th>
              <td>{{ audit.user }}</td>
            </tr>
          </table>
        </div>
        <div class="col-md-6">
          <table class="table table-sm">
            <tr>
              <th class="text-muted">IP Address</th>
              <td>{{ audit.ip_address ?? 'N/A' }}</td>
            </tr>
            <tr>
              <th class="text-muted">User Agent</th>
              <td class="text-truncate" style="max-width: 200px;" title="{{ audit.user_agent }}">
                {{ audit.user_agent|length > 50 ? audit.user_agent|slice(0, 50) ~ '...' : audit.user_agent ?? 'N/A' }}
              </td>
            </tr>
            <tr>
              <th class="text-muted">Date</th>
              <td>{{ audit.created_at }}</td>
            </tr>
          </table>
        </div>
      </div>

      {% if audit.event == 'created' %}
        <h6 class="text-success mb-2"><i class="bi bi-plus-circle me-1"></i> New Values</h6>
        <div class="table-responsive">
          <table class="table table-sm table-bordered mb-0">
            <thead class="table-light">
              <tr>
                <th style="white-space: nowrap; width: 30%;">Field</th>
                <th style="white-space: nowrap;">Value</th>
              </tr>
            </thead>
            <tbody>
              {% for key, value in new_values %}
                <tr>
                  <td class="fw-bold">{{ key }}</td>
                  <td class="text-success">
                    {% if value is iterable %}
                      <code>{{ value|json_encode }}</code>
                    {% else %}
                      {{ value ?? '<em class="text-muted">null</em>'|raw }}
                    {% endif %}
                  </td>
                </tr>
              {% else %}
                <tr>
                  <td colspan="2" class="text-muted text-center">No values recorded</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

      {% elseif audit.event == 'deleted' %}
        <h6 class="text-danger mb-2"><i class="bi bi-trash me-1"></i> Deleted Values</h6>
        <div class="table-responsive">
          <table class="table table-sm table-bordered mb-0">
            <thead class="table-light">
              <tr>
                <th style="white-space: nowrap; width: 30%;">Field</th>
                <th style="white-space: nowrap;">Value</th>
              </tr>
            </thead>
            <tbody>
              {% for key, value in old_values %}
                <tr>
                  <td class="fw-bold">{{ key }}</td>
                  <td class="text-danger">
                    {% if value is iterable %}
                      <code>{{ value|json_encode }}</code>
                    {% else %}
                      {{ value ?? '<em class="text-muted">null</em>'|raw }}
                    {% endif %}
                  </td>
                </tr>
              {% else %}
                <tr>
                  <td colspan="2" class="text-muted text-center">No values recorded</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

      {% elseif audit.event == 'updated' %}
        <h6 class="text-warning mb-2"><i class="bi bi-pencil me-1"></i> Changes</h6>
        <div class="table-responsive">
          <table class="table table-sm table-bordered mb-0">
            <thead class="table-light">
              <tr>
                <th style="white-space: nowrap; width: 25%;">Field</th>
                <th style="white-space: nowrap; width: 37.5%;">Old Value</th>
                <th style="white-space: nowrap; width: 37.5%;">New Value</th>
              </tr>
            </thead>
            <tbody>
              {% for key, change in changes %}
                <tr>
                  <td class="fw-bold">{{ key }}</td>
                  <td class="table-danger">
                    {% if change.old is iterable %}
                      <code>{{ change.old|json_encode }}</code>
                    {% else %}
                      {{ change.old ?? '<em class="text-muted">null</em>'|raw }}
                    {% endif %}
                  </td>
                  <td class="table-success">
                    {% if change.new is iterable %}
                      <code>{{ change.new|json_encode }}</code>
                    {% else %}
                      {{ change.new ?? '<em class="text-muted">null</em>'|raw }}
                    {% endif %}
                  </td>
                </tr>
              {% else %}
                <tr>
                  <td colspan="3" class="text-muted text-center">No changes recorded</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% endif %}
    {% endif %}
  </div>

  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
  </div>
</div>
