<div class="card shad border-0 h-100" id="chart-card-{{ id }}">
  <div class="card-header border-0 d-flex justify-content-between align-items-center">
    <span><i class="bi bi-{{ icon|default('graph-up') }} me-2"></i>{{ title|default('Chart') }}</span>
    <button class="btn btn-sm btn-outline-secondary"
      hx-get="{{ refresh_url }}"
      hx-swap="outerHTML"
      hx-target="#chart-card-{{ id }}">
      <i class="bi bi-arrow-clockwise"></i>
    </button>
  </div>
  <div class="card-body">
    <div class="chart-container">
      <canvas id="{{ id }}"></canvas>
    </div>
  </div>
</div>
<script>
(function() {
  var chartId = '{{ id }}';
  var options = {{ options|raw }};

  // Destroy any existing chart with this ID
  var existing = Chart.getChart(chartId);
  if (existing) existing.destroy();

  // Wait for DOM to settle before creating chart
  requestAnimationFrame(function() {
    var canvas = document.getElementById(chartId);
    if (canvas) {
      new Chart(canvas, options);
    }
  });
})();
</script>
